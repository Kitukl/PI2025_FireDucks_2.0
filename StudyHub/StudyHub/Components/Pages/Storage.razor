@page "/storage"

<div class="storage-container" @onclick="CloseFilterDropdown">
    <div class="storage-header" @onclick:stopPropagation="true">
        <div class="search-wrapper">
            <span class="search-icon">🔍</span>
            <input type="text"
                   placeholder="Search"
                   @bind="searchQuery"
                   @bind:event="oninput"
                   class="storage-search" />
        </div>

        <button class="filter-btn" @onclick="ToggleFilterDropdown" @onclick:stopPropagation="true">
            <span class="filter-icon">☰</span>
            Filter By
        </button>

        <button class="add-files-btn">
            Add Files
        </button>
    </div>

    @if (showFilterDropdown)
    {
        <div class="filter-dropdown" @onclick:stopPropagation="true">
            <div class="filter-option" @onclick='() => SetFilter("")'>All Types</div>
            <div class="filter-option" @onclick='() => SetFilter("Document")'>Documents</div>
            <div class="filter-option" @onclick='() => SetFilter("PDF")'>PDFs</div>
        </div>
    }

    <div class="storage-content" @onclick:stopPropagation="true">
        <div class="files-grid-full">
            @foreach (var item in GetCurrentItems())
            {
                <div class="file-item" @onclick="() => SelectItem(item)">
                    <div class="file-icon">@GetFileIcon(item.Type)</div>
                    <div class="file-name">@item.Name</div>
                    <div class="file-meta">
                        <span class="file-date">@item.Date.ToString("dd.MM.yyyy HH:mm")</span>
                        @if (item.Size.HasValue)
                        {
                            <span class="file-size">@FormatFileSize(item.Size.Value)</span>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private string searchQuery = "";
    private string filterType = "";
    private bool showFilterDropdown = false;
    private StorageItem? selectedItem = null;

    private List<StorageItem> allItems = new();

    protected override void OnInitialized()
    {
        LoadStorageItems();
    }

    private void LoadStorageItems()
    {
        allItems = new List<StorageItem>
        {
            new StorageItem { Name = "Lecture_Notes_Week1.pdf", Type = "PDF", Date = DateTime.Now.AddDays(-7), Size = 2457600 },
            new StorageItem { Name = "Assignment_Math.docx", Type = "Document", Date = DateTime.Now.AddDays(-5), Size = 524288 },
            new StorageItem { Name = "Lab_Report_Chemistry.pdf", Type = "PDF", Date = DateTime.Now.AddDays(-3), Size = 1835008 },
            new StorageItem { Name = "Programming_Project.docx", Type = "Document", Date = DateTime.Now.AddDays(-2), Size = 716800 },
            new StorageItem { Name = "Study_Guide_Physics.pdf", Type = "PDF", Date = DateTime.Now.AddDays(-1), Size = 3145728 },
            new StorageItem { Name = "Essay_Literature.docx", Type = "Document", Date = DateTime.Now.AddHours(-12), Size = 409600 },
            new StorageItem { Name = "Presentation_Slides.pdf", Type = "PDF", Date = DateTime.Now.AddHours(-6), Size = 5242880 },
            new StorageItem { Name = "Research_Paper.docx", Type = "Document", Date = DateTime.Now.AddHours(-3), Size = 1048576 },
            new StorageItem { Name = "Exam_Practice.pdf", Type = "PDF", Date = DateTime.Now.AddHours(-1), Size = 2097152 },
            new StorageItem { Name = "Notes_Biology.docx", Type = "Document", Date = DateTime.Now.AddMinutes(-30), Size = 655360 }
        };
    }

    private IEnumerable<StorageItem> GetCurrentItems()
    {
        var items = allItems.AsEnumerable();

        if (!string.IsNullOrEmpty(searchQuery))
        {
            items = items.Where(i => i.Name.Contains(searchQuery, StringComparison.OrdinalIgnoreCase));
        }

        if (!string.IsNullOrEmpty(filterType))
        {
            items = items.Where(i => i.Type == filterType);
        }

        return items;
    }

    private void SelectItem(StorageItem item)
    {
        selectedItem = item;
    }

    private void ToggleFilterDropdown()
    {
        showFilterDropdown = !showFilterDropdown;
    }

    private void CloseFilterDropdown()
    {
        showFilterDropdown = false;
    }

    private void SetFilter(string type)
    {
        filterType = type;
        showFilterDropdown = false;
    }

    private string GetFileIcon(string type)
    {
        return type switch
        {
            "Document" => "📄",
            "PDF" => "📕",
            _ => "📄"
        };
    }

    private string FormatFileSize(long bytes)
    {
        if (bytes < 1024)
            return $"{bytes} B";
        else if (bytes < 1024 * 1024)
            return $"{bytes / 1024} KB";
        else
            return $"{bytes / (1024 * 1024)} MB";
    }

    public class StorageItem
    {
        public string Name { get; set; } = "";
        public string Type { get; set; } = "";
        public DateTime Date { get; set; }
        public long? Size { get; set; }
    }
}

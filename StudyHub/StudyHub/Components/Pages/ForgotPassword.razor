@page "/forgot-password"
@inject NavigationManager Navigation

<div class="auth-container">
    <div class="auth-logo">
        <img src="images/hat.png" alt="StudyHub" class="auth-logo-icon" />
        <h1 class="auth-logo-text"><span class="title-study">STUDY</span><span class="title-hub">HUB</span></h1>
    </div>

    <div class="auth-card">
        <div class="auth-mascot">
            <img src="images/fireduck.png" alt="FireDucks" />
        </div>
        
        @if (step == 1)
        {
            <h2 class="auth-title">Forgot Password</h2>
            
            <div class="auth-form">
                <div class="form-group">
                    <label>e-mail:</label>
                    <input type="email" @bind="email" class="form-input" />
                </div>

                <button class="auth-btn" @onclick="SendCode">Send code</button>

                <div class="auth-footer">
                    Remembered your password? <a href="/login">Log In</a>
                </div>
            </div>
        }
        else if (step == 2)
        {
            <h2 class="auth-title">Forgot Password</h2>
            
            <div class="auth-form">
                <div class="form-group">
                    <label>e-mail:</label>
                    <input type="email" @bind="email" class="form-input" disabled />
                </div>

                <div class="form-group">
                    <label>Confirmation code:</label>
                    <input type="text" @bind="confirmationCode" class="form-input" placeholder="*****" />
                </div>

                <button class="auth-btn" @onclick="VerifyCode">Confirm</button>

                <div class="auth-footer">
                    Remembered your password? <a href="/login">Log In</a>
                </div>
            </div>
        }
        else if (step == 3)
        {
            <h2 class="auth-title">Forgot h Password</h2>
            
            <div class="auth-form">
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" @bind="newPassword" class="form-input" placeholder="***********" />
                </div>

                <div class="form-group">
                    <label>Confirm password:</label>
                    <input type="password" @bind="confirmNewPassword" class="form-input" placeholder="***********" />
                </div>

                <button class="auth-btn" @onclick="ResetPassword">Reset Password</button>

                @if (showSuccessMessage)
                {
                    <div class="success-message" style="margin-top: 16px; padding: 12px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 8px; text-align: center;">
                        âœ“ Password reset successfully! Redirecting to login...
                    </div>
                }

                <div class="auth-footer">
                    Remembered your password? <a href="/login">Log In</a>
                </div>
            </div>
        }
    </div>
</div>

@code {
    private int step = 1;
    private string email = "";
    private string confirmationCode = "";
    private string newPassword = "";
    private string confirmNewPassword = "";
    private bool showSuccessMessage = false;

    private void SendCode()
    {
        // TODO: Send confirmation code to email
        step = 2;
    }

    private void VerifyCode()
    {
        // TODO: Verify confirmation code
        step = 3;
    }

    private void ResetPassword()
    {
        // TODO: Implement actual password reset logic with backend
        showSuccessMessage = true;
        StateHasChanged();
        
        // Redirect to login after 2 seconds
        Task.Delay(2000).ContinueWith(_ => 
        {
            Navigation.NavigateTo("/login");
        });
    }
}
